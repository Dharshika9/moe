{"version":3,"sources":["../../src/plugins/lists.js"],"names":["UL","OL","LI","INCREASE_INDENT","DECREASE_INDENT","ListsPlugin","props","DEFAULT_NODE","plugin","types","typeItem","typeDefault","plugins","Plugin","createButton","type","icon","editorState","onChange","changes","wrapInList","unwrapList","increaseItemDepth","decreaseItemDepth","onClick","e","preventDefault","change","inList","utils","isSelectionInList","value","isType","blocks","some","document","getClosest","block","key","parent","isIncreaseDecrease","previousItem","getPreviousItem","currentItem","getCurrentItem","itemDepth","getItemDepth","canIncreaseIndent","canDecreaseIndent","increaseDecreaseDisabled","name","schema","nodes","toolbarButtons","deserialize","el","next","tagName","toLowerCase","object","childNodes","serialize","children","renderNode","attributes","node"],"mappings":"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","file":"lists.js","sourcesContent":["/*\n * This file is part of ORY Editor.\n *\n * ORY Editor is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * ORY Editor is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with ORY Editor.  If not, see <http://www.gnu.org/licenses/>.\n *\n * @license LGPL-3.0\n * @copyright 2016-2018 Aeneas Rekkas\n * @author Aeneas Rekkas <aeneas+oss@aeneas.io>\n *\n */\n\n/* eslint-disable prefer-reflect, default-case, react/display-name */\nimport React from 'react'\nimport ListIcon from '@material-ui/icons/List'\nimport OrderedListIcon from '@material-ui/icons/FormatListNumbered'\nimport IncreaseIndentIcon from '@material-ui/icons/FormatIndentIncrease'\nimport DecreaseIndentIcon from '@material-ui/icons/FormatIndentDecrease'\nimport type { Props } from './props'\nimport createListPlugin from 'slate-edit-list'\n\nimport { makeTagNode, ToolbarButton } from '../helpers'\nimport Plugin from './Plugin'\n\nexport const UL = 'LISTS/UNORDERED-LIST'\nexport const OL = 'LISTS/ORDERED-LIST'\nexport const LI = 'LISTS/LIST-ITEM'\n\nconst INCREASE_INDENT = 'INCREASE_INDENT'\nconst DECREASE_INDENT = 'DECREASE_INDENT'\n\nexport default class ListsPlugin extends Plugin {\n  constructor(props: Props) {\n    super(props);\n\n    this.DEFAULT_NODE = props.DEFAULT_NODE;\n    this.plugin = createListPlugin({\n      types: [UL, OL],\n      typeItem: LI,\n      typeDefault: props.DEFAULT_NODE\n    })\n    this.plugins = [\n      this.plugin\n    ]\n  }\n\n  props: Props\n\n  // eslint-disable-next-line react/display-name\n  createButton = (type, icon) => ({ editorState, onChange }: Props) => {\n    const {\n      wrapInList,\n      unwrapList,\n      increaseItemDepth,\n      decreaseItemDepth\n    } = this.plugin.changes\n    const onClick = e => {\n      e.preventDefault()\n\n      let change = editorState.change()\n\n      if (type !== UL && type !== OL) {\n        if (type === INCREASE_INDENT) {\n          increaseItemDepth(change)\n        } else {\n          decreaseItemDepth(change)\n        }\n      } else {\n        const inList = this.plugin.utils.isSelectionInList(editorState);\n        if (inList) {\n          unwrapList(change, type)\n        } else {\n          wrapInList(change, type)\n        }\n      }\n\n      onChange({ value: change.value })\n    }\n\n    const inList = this.plugin.utils.isSelectionInList(editorState);\n    const isType = editorState.blocks.some(block =>\n      !!editorState.document.getClosest(\n        block.key,\n        parent => parent.type === type\n      )\n    )\n    const isIncreaseDecrease = type === INCREASE_INDENT || type === DECREASE_INDENT\n\n    const previousItem = this.plugin.utils.getPreviousItem(editorState);\n    const currentItem = this.plugin.utils.getCurrentItem(editorState);\n    const itemDepth = this.plugin.utils.getItemDepth(editorState);\n\n    const canIncreaseIndent = previousItem && currentItem && isIncreaseDecrease\n    const canDecreaseIndent = itemDepth > 1 && currentItem && isIncreaseDecrease\n\n    const increaseDecreaseDisabled = type === INCREASE_INDENT ? !canIncreaseIndent : !canDecreaseIndent\n\n    return (\n      <ToolbarButton\n        onClick={onClick}\n        isActive={inList && isType}\n        icon={icon}\n        disabled={isIncreaseDecrease && increaseDecreaseDisabled}\n      />\n    )\n  }\n\n  name = 'lists'\n\n  schema = {\n    nodes: {\n      [UL]: makeTagNode('ul'),\n      [OL]: makeTagNode('ol'),\n      [LI]: makeTagNode('li')\n    }\n  }\n\n  toolbarButtons = [\n    this.createButton(UL, <ListIcon />),\n    this.createButton(OL, <OrderedListIcon />),\n    this.createButton(INCREASE_INDENT, <IncreaseIndentIcon />),\n    this.createButton(DECREASE_INDENT, <DecreaseIndentIcon />),\n  ]\n\n  deserialize = (el, next) => {\n    switch (el.tagName.toLowerCase()) {\n      case 'ul':\n        return {\n          object: 'block',\n          type: UL,\n          nodes: next(el.childNodes)\n        }\n      case 'li':\n        return {\n          object: 'block',\n          type: LI,\n          nodes: next(el.childNodes)\n        }\n      case 'ol':\n        return {\n          object: 'block',\n          type: OL,\n          nodes: next(el.childNodes)\n        }\n    }\n  }\n\n  serialize = (object: { type: string, object: string }, children: any[]) => {\n    if (object.object !== 'block') {\n      return\n    }\n    switch (object.type) {\n      case UL:\n        return <ul>{children}</ul>\n      case LI:\n        return <li>{children}</li>\n      case OL:\n        return <ol>{children}</ol>\n    }\n  }\n\n  renderNode = props => {\n    const { children, attributes } = props;\n    switch (props.node.type) {\n      case UL:\n        return <ul {...attributes}>{children}</ul>\n      case LI:\n        return <li {...attributes}>{children}</li>\n      case OL:\n        return <ol {...attributes}>{children}</ol>\n    }\n  }\n}\n"]}