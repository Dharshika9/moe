{"version":3,"sources":["../src/hooks.js"],"names":["DEFAULT_NODE","P","defaultPlugins","ParagraphPlugin","EmphasizePlugin","HeadingsPlugin","LinkPlugin","CodePlugin","ListsPlugin","BlockquotePlugin","AlignmentPlugin","lineBreakSerializer","deserialize","el","tagName","toLowerCase","object","text","nodeName","value","match","leaves","serialize","children","type","html","Html","rules","parseHtml","parse5","parseFragment","options","createInitialState","editorState","Value","fromJSON","document","nodes","unserialize","importFromHtml","serialized","toJSON","merge","states","mergedNodes","a","b","concat","mergedDocument","Document","create","mergedEditorState","split","state","map","node","splittedDocument","splittedEditorState","toArray","handleRemoveHotKey","_","content","Promise","resolve","reject","Plain","length","windowSelectionWaitTime","handleFocusPreviousHotKey","e","selection","isExpanded","setTimeout","isAtStartOf","first","handleFocusNextHotKey","isAtEndOf","last"],"mappings":"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","file":"hooks.js","sourcesContent":["/*\n * This file is part of ORY Editor.\n *\n * ORY Editor is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *  \n * ORY Editor is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *  \n * You should have received a copy of the GNU Lesser General Public License\n * along with ORY Editor.  If not, see <http://www.gnu.org/licenses/>.\n *\n * @license LGPL-3.0\n * @copyright 2016-2018 Aeneas Rekkas\n * @author Aeneas Rekkas <aeneas+oss@aeneas.io>\n *\n */\n\n// @flow\n// FIXME #125: missing types for slate internals\n/* eslint-disable new-cap, arrow-body-style, react/display-name */\nimport { List } from 'immutable'\nimport head from 'ramda/src/head'\nimport map from 'ramda/src/map'\nimport path from 'ramda/src/path'\nimport reduce from 'ramda/src/reduce'\nimport tail from 'ramda/src/tail'\nimport React from 'react'\nimport type { Props } from './Component'\nimport AlignmentPlugin from './plugins/alignment'\nimport BlockquotePlugin from './plugins/blockquote'\nimport CodePlugin from './plugins/code'\nimport EmphasizePlugin from './plugins/emphasize'\nimport HeadingsPlugin from './plugins/headings'\nimport LinkPlugin from './plugins/link'\nimport ListsPlugin from './plugins/lists'\nimport ParagraphPlugin, { P } from './plugins/paragraph'\nimport parse5 from 'parse5'\n\n// FIXME #126\nimport { Document, Value } from 'slate'\nimport Html from 'slate-html-serializer'\nimport Plain from 'slate-plain-serializer'\n\nconst DEFAULT_NODE = P\n\nexport const defaultPlugins = [\n  new ParagraphPlugin(),\n  new EmphasizePlugin(),\n  new HeadingsPlugin({ DEFAULT_NODE }),\n  new LinkPlugin(),\n  new CodePlugin({ DEFAULT_NODE }),\n  new ListsPlugin({ DEFAULT_NODE }),\n  new BlockquotePlugin({ DEFAULT_NODE }),\n  new AlignmentPlugin()\n  // new KatexPlugin({ DEFAULT_NODE })\n]\n\nexport const lineBreakSerializer = {\n  deserialize(el: any) {\n    if (el.tagName.toLowerCase() === 'br') {\n      return { object: 'text', text: '\\n' }\n    }\n    if (el.nodeName === '#text') {\n      if (el.value && el.value.match(/<!--.*?-->/)) return\n\n      return {\n        object: 'text',\n        leaves: [\n          {\n            object: 'leaf',\n            text: el.value\n          }\n        ]\n      }\n    }\n  },\n  serialize(object: any, children: any) {\n    if (object.type === 'text' || children === '\\n') {\n      return <br />\n    }\n  }\n}\n\nexport const html = new Html({\n  rules: [...defaultPlugins, lineBreakSerializer],\n  parseHtml: parse5.parseFragment\n})\n\nconst options = {}\n\nexport const createInitialState = () => ({\n  editorState: Value.fromJSON(\n    {\n      document: {\n        nodes: [\n          {\n            object: 'block',\n            type: P,\n            nodes: [\n              {\n                object: 'text',\n                leaves: [\n                  {\n                    text: ''\n                  }\n                ]\n              }\n            ]\n          }\n        ]\n      }\n    },\n    options\n  )\n})\n\nexport const unserialize = ({\n  importFromHtml,\n  serialized,\n  editorState\n}: {\n  importFromHtml: string,\n  serialized: Object,\n  editorState: Object\n}): { editorState: Object } => {\n  if (serialized) {\n    return { editorState: Value.fromJSON(serialized, options) }\n  } else if (importFromHtml) {\n    return { editorState: html.deserialize(importFromHtml, options) }\n  } else if (editorState) {\n    return { editorState }\n  }\n\n  return createInitialState()\n}\n\nexport const serialize = ({ editorState }: any) => ({\n  serialized: editorState.toJSON(editorState, options)\n})\n\nexport const merge = (states: Object[]): Object => {\n  const nodes = map(path(['editorState', 'document', 'nodes']), states)\n  const mergedNodes = reduce(\n    (a: List<any>, b: List<any>) => a.concat(b),\n    head(nodes),\n    tail(nodes)\n  )\n  const mergedDocument = Document.create({ nodes: mergedNodes })\n  const mergedEditorState = Value.create({ document: mergedDocument })\n\n  return { editorState: mergedEditorState }\n}\n\nexport const split = (state: Object): Object[] => {\n  const nodes = path(['editorState', 'document', 'nodes'], state)\n\n  return nodes\n    .map((node: any) => {\n      const splittedDocument = Document.create({ nodes: List([node]) })\n      const splittedEditorState = Value.create({ document: splittedDocument })\n\n      return { editorState: splittedEditorState }\n    })\n    .toArray()\n}\n\n// const position = (): {\n//   top: ?number,\n//   right: ?number,\n//   left: ?number,\n//   bottom: ?number\n// } => {\n//   if (window && window.getSelection) {\n//     const selection = window.getSelection()\n//     if (!selection.rangeCount) {\n//       return {\n//         top: null,\n//         right: null,\n//         left: null,\n//         bottom: null,\n//       }\n//     }\n//\n//     return selection.getRangeAt(0).getBoundingClientRect()\n//   }\n//\n//   if (window.document.selection) {\n//     return window.document.selection\n//       .createRange()\n//       .getBoundingClientRect()\n//   }\n//\n//   return {\n//     top: null,\n//     right: null,\n//     left: null,\n//     bottom: null,\n//   }\n// }\n\n// if editor state is empty, remove cell when backspace or delete was pressed.\nexport const handleRemoveHotKey = (\n  _: KeyboardEvent,\n  {\n    content: {\n      state: { editorState }\n    }\n  }: Props\n) =>\n  new Promise(\n    (resolve: Function, reject: Function) =>\n      Plain.serialize(editorState).length < 1 ? resolve() : reject()\n  )\n\nconst windowSelectionWaitTime = 1\n\nexport const handleFocusPreviousHotKey = (\n  e: KeyboardEvent,\n  {\n    content: {\n      state: { editorState }\n    }\n  }: Props\n) => {\n  // const isArrowUp = e.keyCode === 38\n\n  return new Promise((resolve: Function, reject: Function) => {\n    if (editorState.selection.isExpanded) {\n      return reject()\n    }\n\n    setTimeout(() => {\n      // if (isArrowUp && next.top === current.top) {\n      //   return resolve()\n      // } else\n      if (\n        editorState.selection.isAtStartOf(editorState.document.nodes.first())\n      ) {\n        return resolve()\n      }\n      reject()\n    }, windowSelectionWaitTime)\n  })\n}\n\nexport const handleFocusNextHotKey = (\n  e: KeyboardEvent,\n  {\n    content: {\n      state: { editorState }\n    }\n  }: Props\n) => {\n  // const isArrowDown = e.keyCode === 40\n\n  return new Promise((resolve: Function, reject: Function) => {\n    if (editorState.selection.isExpanded) {\n      return reject()\n    }\n\n    setTimeout(() => {\n      // if (isArrowDown && next.top === current.top) {\n      //   return resolve()\n      // } else\n      if (editorState.selection.isAtEndOf(editorState.document.nodes.last())) {\n        return resolve()\n      }\n      reject()\n    }, windowSelectionWaitTime)\n  })\n}\n"]}